---
title: "BES Assignment"
author:
      - _Anılcan_ _Atik_
      - _Dost_ _Karaahmetli_
      - _Kutay_ _Akalın_
      - _Tunahan_ _Kılıç_
      
date: "November 8th, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## BES Dataset

This is a worksheet of BES Assignment.The dataset for this project includes key indicators of Individual Pension System (BES) from the July 2017 through July 2019.

## Preparing and Cleaning Dataset 
We begin the project by reading the excel files that we download from the [EGM website](https://www.egm.org.tr/bilgi-merkezi/istatistikler/). After the "Rapor Tarihi" filter was removed, raw data was created in the excel sheet. This sheet was uploaded to [spo'R'ify github page](https://github.com/pjournal/mef03g-spo-R-ify/tree/master/BES%20Assignment) for further analysis. Downloading file and cleaning process has given below:


```{r warning=FALSE,message=FALSE}
library(tidyverse)
library(readxl)
library(bsts)

#Downloading the excelel file
tmp<-tempfile(fileext=".xlsx")

download.file("https://github.com/pjournal/mef03g-spo-R-ify/blob/master/BES%20Assignment/BES_2017_07.2019.xlsx?raw=true",mode="wb",destfile=tmp)
                      
bes_data <-readxl::read_excel(tmp,skip=2,col_names=FALSE)

file.remove(tmp)

#cleaining process
names(bes_data) <- c("sirket_adi", "katilimci_sayisi", "katilimci_fon_TL", "devlet_katkisi_TL", "katki_payi_TL", "tarih", "ss_emekli_sayisi", "ss_bireysel_sozlesme", "ss_grup_bireysel_sozlesme", "ss_isveren_grup_sertifika", "ss_toplam", "yy_bireysel_TL", "yy_grup_bireysel_TL", "yy_isveren_grup_TL", "yy_toplam_TL")

bes_data$tarih <-  format(as.Date(bes_data$tarih), "%Y-%m-%d")

bes_data$tarih <- as.Date(bes_data$tarih)

#To use monthly data, we need to get the last day of each month. With this code, we select the last day of the month.
#In pipe, "filter(tarih %in% lastday)" can be used.
lastday <- unique(LastDayInMonth(bes_data$tarih))

bes_data <- bes_data %>% mutate_if(is.numeric,funs(ifelse(is.na(.),0,.)))

```



## Loding Libraries and Civilized Data Display
```{r warning=FALSE,message=FALSE}
library(tidyverse)
library(ggplot2)
library(zoo)
library(scales)
library(formattable)
library(knitr)
library(bsts)

print(bes_data,width=Inf)
```



### Total Fund Values for Each Firm Yearly
```{r fig.height=10, fig.width=10, fig.asp= .60}
bes_data_monthly<- bes_data %>% filter(tarih %in% lastday) %>% mutate (year = format(tarih,"%Y"),month=format(tarih,"%B")) 

slct_1<-bes_data_monthly %>% filter (month == "July")

ggplot(slct_1,aes(x=sirket_adi,y=katilimci_fon_TL ,fill=ordered(year))) +geom_bar(stat="identity",position="dodge") + labs(y="Total Funds",x="Firms",fill="") + theme(axis.text.x = element_text(angle = 90, hjust = 1))+scale_y_continuous(labels=comma) 

```
